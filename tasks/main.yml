---
- name: Install TFTP
  ansible.builtin.package:
    state: present
    name: tftp-server
  when: ansible_os_family == 'RedHat'

- name: Install TFTP
  ansible.builtin.package:
    state: present
    name: tftpd-hpa
  when: ansible_os_family == 'Debian'

- name: Allow TFTP traffic in firewalld on port
  ansible.posix.firewalld:
    service: tftp
    permanent: true
    state: enabled
    immediate: true
  when: ansible_os_family == 'RedHat'

- name: Allow TFTP traffic in ufw
  community.general.ufw:
    rule: allow
    proto: udp
    port: 69
  when: ansible_os_family == 'Debian'

- name: Copy tftp systemd file
  ansible.builtin.template:
    src: tftp.service.j2
    dest: /etc/systemd/system/tftp.service
    owner: root
    group: root
    mode: '0644'
  notify: tftp service restart

- name: Start and enable tftp service
  ansible.builtin.service:
    name: tftp
    state: started
    enabled: true
    daemon_reload: true
